webpackJsonp([1],{"+IYe":function(t,e){},"0W13":function(t,e){},BCnH:function(t,e){},EqrD:function(t,e){},FsJg:function(t,e,s){var i={"./cat":"MGUO","./cat.js":"MGUO","./cd":"OkV7","./cd.js":"OkV7","./chmod":"thPH","./chmod.js":"thPH","./common":"8y2q","./common.js":"8y2q","./cp":"kEp2","./cp.js":"kEp2","./dirs":"lK6y","./dirs.js":"lK6y","./echo":"IRJ8","./echo.js":"IRJ8","./error":"HxTw","./error.js":"HxTw","./exec":"VQ1x","./exec.js":"VQ1x","./find":"r+ID","./find.js":"r+ID","./grep":"T3mR","./grep.js":"T3mR","./head":"jMmx","./head.js":"jMmx","./ln":"4Bxg","./ln.js":"4Bxg","./ls":"MULN","./ls.js":"MULN","./mkdir":"3ORl","./mkdir.js":"3ORl","./mv":"PcVt","./mv.js":"PcVt","./popd":"h3Dv","./popd.js":"h3Dv","./pushd":"PGBa","./pushd.js":"PGBa","./pwd":"+UCj","./pwd.js":"+UCj","./rm":"EaF0","./rm.js":"EaF0","./sed":"/j+X","./sed.js":"/j+X","./set":"c0cj","./set.js":"c0cj","./sort":"yc2b","./sort.js":"yc2b","./tail":"i//j","./tail.js":"i//j","./tempdir":"RvNk","./tempdir.js":"RvNk","./test":"U9dR","./test.js":"U9dR","./to":"xlaY","./to.js":"xlaY","./toEnd":"Lk2e","./toEnd.js":"Lk2e","./touch":"0Qa2","./touch.js":"0Qa2","./uniq":"lTxy","./uniq.js":"lTxy","./which":"GiAy","./which.js":"GiAy"};function n(t){return s(a(t))}function a(t){var e=i[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}n.keys=function(){return Object.keys(i)},n.resolve=a,t.exports=n,n.id="FsJg"},IlTn:function(t,e){},J7no:function(t,e){},NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("mvHQ"),n=s.n(i),a=s("7+uW"),o={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("keep-alive",[this.$route.meta.keepAlive?e("router-view"):this._e()],1),this._v(" "),this.$route.meta.keepAlive?this._e():e("router-view")],1)},staticRenderFns:[]};var r=s("VU/8")({name:"App"},o,!1,function(t){s("0W13")},null,null).exports,c=s("/ocq"),l=s("Dd8w"),u=s.n(l),d=s("NYxO"),h={name:"login",data:function(){return{stuId:"",password:"",obj:{}}},computed:u()({},Object(d.c)(["hasLogin","errorLogin","userinfo"])),created:function(){var t=JSON.parse(window.localStorage.getItem("userinfo"));if(t){var e=(Date.parse(new Date)/1e3-t.last_login)/3600;console.log("距离上次登录已过了："+e+"小时"),e>0&&e<24&&(this.stuId=t.stuId,this.password=t.password,this.login())}},methods:u()({},Object(d.b)(["actionLogin","actionNotLogin","actionInitMessagePush"]),{login:function(){this.obj={stuId:this.stuId,password:this.password},console.log(this.obj),this.actionNotLogin(),this.actionLogin(this.obj)}}),watch:{hasLogin:function(){if(console.log("haslogin"),this.hasLogin){var t="ws://127.0.0.1:8000/push/"+this.userinfo.id+"/";this.actionInitMessagePush(t),this.$router.push("/home")}},errorLogin:function(){this.errorLogin&&this.$message({message:this.errorLogin,center:!0,type:"warning"})}}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"top"},[s("div",{staticClass:"main"},[s("span",{staticClass:"title"},[t._v("BOOX")]),t._v(" "),s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{xs:17,sm:9,md:7,lg:5}},[s("el-input",{attrs:{placeholder:"请输入学号","prefix-icon":"el-icon-service",clearable:""},model:{value:t.stuId,callback:function(e){t.stuId=e},expression:"stuId"}})],1)],1),t._v(" "),s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{xs:17,sm:9,md:7,lg:5}},[s("el-input",{attrs:{placeholder:"请输入密码","prefix-icon":"el-icon-view",clearable:"",type:"password"},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}})],1)],1),t._v(" "),s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{xs:17,sm:9,md:7,lg:5}},[s("el-button",{attrs:{type:"primary",disabled:!t.password||!t.stuId},on:{click:function(e){t.login()}}},[t._v("登录")])],1)],1),t._v(" "),s("el-row",{staticClass:"tips",attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{xs:17,sm:9,md:7,lg:5}},[s("router-link",{attrs:{to:"/register"}},[s("span",{staticClass:"remind"},[t._v("还没有账号？去注册")])])],1)],1)],1)])},staticRenderFns:[]};var g=s("VU/8")(h,m,!1,function(t){s("jvYL")},"data-v-8c6fa162",null).exports,p=s("bOdI"),f=s.n(p),v=s("//Fk"),_=s.n(v),b=s("fZjL"),w=s.n(b),y=s("mtWM"),C=s.n(y),S=function(t){var e=new FormData;return console.log(w()(t)),console.log(t),e.append("stuId",t.stuId),e.append("password",t.password),console.log(e),fetch("http://127.0.0.1:8000/users/login/",{method:"POST",mode:"cors",body:e}).then(function(t){return console.log(t),t.json()}).then(function(t){return console.log(t.seesionid),t})},k=function(t){return console.log("param",t),C.a.post("http://127.0.0.1:8000/users/register/",t).then(function(t){return t.data})},x=function(t){return C.a.post("http://127.0.0.1:8000/users/getImgUploadToken/",t,{}).then(function(t){return t.data})},I=function(t){return C.a.post("http://127.0.0.1:8000/users/changeAvatar/",t,{headers:{Authorization:"token "+window.localStorage.getItem("token")}}).then(function(t){return t.data})},M=function(t){return C.a.post("http://127.0.0.1:8000/users/changePassword/",t,{headers:{Authorization:"token "+window.localStorage.getItem("token")}}).then(function(t){return t.data})},L=function(t){return C.a.get("http://127.0.0.1:8000/commodities/",{headers:{}}).then(function(t){return console.log(t),t})},j=function(t,e){return C.a.get("http://127.0.0.1:8000/commodities/?search="+t,{withCredentials:!0}).then(function(t){return console.log(t),t.data})},P=function(t){return C.a.post("http://127.0.0.1:8000/commodities/",t,{headers:{Authorization:"token "+window.localStorage.getItem("token")},withCredentials:!0}).then(function(t){return t.data})},U=function(t){return fetch("http://127.0.0.1:8000/commodities/mine",{method:"GET",credentials:"include",withCredentials:"true"}).then(function(t){return console.log(t),t})},R=function(t){return C.a.post("http://127.0.0.1:8000/collect/changeCollectState/",t,{headers:{Authorization:"token "+window.localStorage.getItem("token")}}).then(function(t){return t.data})},E=function(){return C.a.get("http://127.0.0.1:8000/collect/getCollectionList/",{headers:{Authorization:"token "+window.localStorage.getItem("token")}}).then(function(t){return t.data})},O={name:"imgUpload",props:{limit:String,multiple:Boolean},data:function(){return{dialogImageUrl:"",dialogVisible:!1,imgNum:0,imgQuality:.5,imgWidthHeight:""}},computed:u()({},Object(d.c)(["userinfo","imgName","qiniuaddr","domain"]),{watchUploadState:function(){this.imgNum===this.imgName.length&&0!==this.imgNum&&this.actionUploadSuccess()}}),methods:u()({},Object(d.b)(["actionGetUploadToken","actionUploadSuccess"]),{uploadImg:function(){this.$refs.upload.submit()},dataURItoBlob:function(t,e){for(var s=atob(t.split(",")[1]),i=[],n=0;n<s.length;n++)i.push(s.charCodeAt(n));return new Blob([new Uint8Array(i)],{type:e})},beforeUpload:function(t){var e=this;return t.size/1024/1024>1?new _.a(function(s){var i=new FileReader,n=new Image;n.onload=function(i){var a=document.createElement("canvas"),o=a.getContext("2d"),r=n.width*e.imgQuality,c=n.height*e.imgQuality;e.imgWidthHeight=r+"/"+c,a.width=r,a.height=c,o.clearRect(0,0,r,c),o.drawImage(n,0,0,r,c);var l=a.toDataURL(t.type),u=e.dataURItoBlob(l,t.type);s(u)},i.onload=function(t){n.src=t.target.result},i.readAsDataURL(t)}):new _.a(function(s){var i=new FileReader,n=new Image;n.onload=function(t){var i=n.width,a=n.height;e.imgWidthHeight=i+"/"+a,s()},i.onload=function(t){n.src=t.target.result},i.readAsDataURL(t)})},handldChange:function(t,e){this.imgNum=e.length;var s=document.getElementsByClassName("el-upload")[0];e.length>=this.limit-0&&(s.style.display="none")},upqiniu:function(t){var e={filetype:"image/png"===t.file.type?"png":"jpg",param:t,imgWidthHeight:this.imgWidthHeight};this.actionGetUploadToken(e)},handleRemove:function(t,e){this.imgNum=e.length;var s=document.getElementsByClassName("el-upload")[0];e.length<this.limit-0&&(s.style.display="inline-block")},handlePictureCardPreview:function(t){this.dialogImageUrl=t.url,this.dialogVisible=!0}})},N={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-upload",{ref:"upload",attrs:{action:t.domain,accept:"image/jpeg,image/png","auto-upload":!1,"http-request":t.upqiniu,limit:t.limit,multiple:t.multiple,"list-type":"picture-card","before-upload":t.beforeUpload,"on-preview":t.handlePictureCardPreview,"on-change":t.handldChange,"on-remove":t.handleRemove}},[s("i",{staticClass:"el-icon-plus"}),t._v(t._s(t.watchUploadState)+"\n  ")]),t._v(" "),s("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("img",{attrs:{width:"100%",src:t.dialogImageUrl,alt:""}})])],1)},staticRenderFns:[]};var $=s("VU/8")(O,N,!1,function(t){s("O/+H")},null,null).exports,T={name:"myHeader",props:{headerMsg:Object},data:function(){return{startx:"",starty:""}},created:function(){},methods:{left:function(){this.$parent.headerLeft()},right:function(){this.$parent.headerRight()},center:function(){this.$parent.headerCenter()}}},A={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"main"},[s("div",{staticClass:"left",on:{click:function(e){t.left()}}},[s("img",{attrs:{src:t.headerMsg.leftImg}}),t._v(" "),s("span",{staticClass:"left-word"},[t._v(t._s(t.headerMsg.centerWord))])]),t._v(" "),s("div",{staticClass:"right"},[s("img",{attrs:{src:t.headerMsg.rightImg},on:{click:function(e){t.right()}}})]),t._v(" "),s("div",{staticClass:"center"},[s("img",{attrs:{src:t.headerMsg.centerImg},on:{click:function(e){t.center()}}})])]),t._v(" "),s("div",{staticClass:"block"})])},staticRenderFns:[]};var q=s("VU/8")(T,A,!1,function(t){s("e1/e")},"data-v-e7be3ae8",null).exports,W={name:"loading",props:{successMsg:String,errorMsg:String},data:function(){return{}},computed:u()({},Object(d.c)(["publishState"]),{monitorState:function(){var t=this,e=null;2==this.publishState?e=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)"}):1==this.publishState?((e=this.$loading({})).close(),e=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)",text:this.successMsg,spinner:"el-icon-check"}),setTimeout(function(){e.close(),t.$parent.afterLoading()},1e3)):-1==this.publishState&&((e=this.$loading({})).close(),e=this.$loading({lock:!0,background:"rgba(0, 0, 0, 0.7)",text:this.errorMsg,spinner:"el-icon-close"}),setTimeout(function(){e.close()},1e3))}})},F={render:function(){var t=this.$createElement;return(this._self._c||t)("div",[this._v("\n  "+this._s(this.monitorState)+"\n")])},staticRenderFns:[]};var G=s("VU/8")(W,F,!1,function(t){s("wWa2")},"data-v-3d785334",null).exports,H={name:"register",components:{"v-upload":$,"v-header":q},data:function(){var t;return t={headerMsg:{centerWord:"注册",leftImg:"/static/images/back.png"},stuId:"1",password1:"1",password2:"1",nickname:"1",email:"1",phone:"1",class_num:"1",campus:"1",loading:!1,active:0},f()(t,"loading",!1),f()(t,"submitErrorMsg","提交失败"),t},computed:u()({},Object(d.c)(["errorRegister","hasRegister","registering","publishState"])),methods:u()({},Object(d.b)(["actionRegister","actionPublishError","actionClearImgInfo"]),Object(d.d)(["notPublish","publishing"]),{next:function(){this.checkMessage()&&this.active++},checkMessage:function(){return this.password1===this.password2||(this.$message({message:"两次密码不一致",center:!0,type:"warning"}),!1)},register:function(){var t={stuId:this.stuId,nickname:this.nickname,password:this.password1,campus:this.campus,class_num:this.class_num,phone:this.phone};this.actionRegister(t),this.publishing(),console.log("adf")},headerLeft:function(){0===this.active?history.back():this.active--},afterLoading:function(){清空存在vuex里的图片信息,this.actionClearImgInfo(),将发布状态设为未发布状态,this.notPublish()}}),watch:{errorRegister:function(){this.errorRegister&&this.$message.error(this.errorRegister)},hasRegister:function(){this.hasRegister&&(this.active=2)}}},V={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"main"},[s("v-header",{attrs:{headerMsg:t.headerMsg}}),t._v(" "),s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{xs:17,sm:9,md:7,lg:5}},[s("el-steps",{attrs:{active:t.active,"finish-status":"success","align-center":""}},[s("el-step",{attrs:{title:"学生认证"}}),t._v(" "),s("el-step",{attrs:{title:"账户注册"}})],1)],1)],1),t._v(" "),0===t.active?s("div",{staticClass:"step1"},[s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{xs:17,sm:9,md:7,lg:5}},[s("el-input",{attrs:{placeholder:"您的学号","prefix-icon":"el-icon-user",clearable:""},model:{value:t.stuId,callback:function(e){t.stuId=e},expression:"stuId"}})],1)],1),t._v(" "),s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{xs:17,sm:9,md:7,lg:5}},[s("el-input",{attrs:{placeholder:"输入密码","prefix-icon":"el-icon-view",type:"password",clearable:""},model:{value:t.password1,callback:function(e){t.password1=e},expression:"password1"}})],1)],1),t._v(" "),s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{xs:17,sm:9,md:7,lg:5}},[s("el-input",{attrs:{placeholder:"确认密码","prefix-icon":"el-icon-view",type:"password",clearable:""},model:{value:t.password2,callback:function(e){t.password2=e},expression:"password2"}})],1)],1),t._v(" "),s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{xs:17,sm:9,md:7,lg:5}},[s("el-button",{attrs:{type:"primary",disabled:!t.password1||!t.stuId||!t.password2},on:{click:function(e){t.next()}}},[t._v("下一步")])],1)],1)],1):t._e(),t._v(" "),1===t.active?s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.registering,expression:"registering"}],staticClass:"step2"},[s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{xs:17,sm:9,md:7,lg:5}},[s("el-input",{attrs:{placeholder:"请输入邮箱","prefix-icon":"el-icon-message",type:"email",clearable:""},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}})],1)],1),t._v(" "),s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{xs:17,sm:9,md:7,lg:5}},[s("el-input",{attrs:{placeholder:"请输入手机号","prefix-icon":"el-icon-mobile-phone",clearable:""},model:{value:t.phone,callback:function(e){t.phone=e},expression:"phone"}})],1)],1),t._v(" "),s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{xs:17,sm:9,md:7,lg:5}},[s("el-input",{attrs:{placeholder:"您的学院","prefix-icon":"el-icon-school",clearable:""},model:{value:t.campus,callback:function(e){t.campus=e},expression:"campus"}})],1)],1),t._v(" "),s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{xs:17,sm:9,md:7,lg:5}},[s("el-input",{attrs:{placeholder:"您的班级","prefix-icon":"el-icon-reading",clearable:""},model:{value:t.class_num,callback:function(e){t.class_num=e},expression:"class_num"}})],1)],1),t._v(" "),s("el-row",{attrs:{type:"flex",justify:"center"}},[s("el-col",{attrs:{xs:17,sm:9,md:7,lg:5}},[s("el-button",{attrs:{type:"primary",disabled:!(t.email&&t.campus&&t.phone&&t.class_num)},on:{click:function(e){t.register()}}},[t._v("注册")])],1)],1)],1):t._e()],1)},staticRenderFns:[]};var D=s("VU/8")(H,V,!1,function(t){s("ejIq")},"data-v-0a985038",null).exports,J=s("c/Tr"),B=s.n(J),Q={name:"newList",props:{list:Object},data:function(){return{placeholderChart:""}},computed:{},created:function(){console.log("new list created");var t=document.createElement("canvas"),e=t.getContext("2d"),s=this.list.first_img_width_height.split("/");t.width=Number(s[0]),t.height=Number(s[1]),e.fillStyle="#e0e0e0",e.fillRect(0,0,t.width,t.height),this.placeholderChart=t.toDataURL()},methods:{showDetail:function(){window.localStorage.setItem("detail",n()(this.list)),this.$router.push("/detail")}}},z={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"newList-main",on:{click:function(e){t.showDetail()}}},[s("el-card",{attrs:{"body-style":{padding:"0px"}}},[s("el-image",{attrs:{src:t.list.pics[0].pic}},[s("div",{staticClass:"image-slot",attrs:{slot:"placeholder"},slot:"placeholder"},[t._v("\n        加载中"),s("span",{staticClass:"dot"},[t._v("...")])])]),t._v(" "),s("div",{staticStyle:{padding:"5px","text-align":"left"}},[s("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(t.list.name))]),t._v(" "),s("div",{staticClass:"price"},[t._v("￥"+t._s(t.list.price))]),t._v(" "),s("div",{staticClass:"time"},[t._v(t._s(t.list.stuId)+" 发布于"+t._s(t.list.publish_time))])])],1)],1)},staticRenderFns:[]};var Y=s("VU/8")(Q,z,!1,function(t){s("X9qx")},"data-v-d32d9880",null).exports,X={name:"topMenu",props:{activeIndex:String},data:function(){return{}},computed:u()({},Object(d.c)(["unreadMsgLength"])),methods:{handleMenu:function(t,e){switch(t){case"1":this.$router.push("/home");break;case"2":this.$router.push("/search");break;case"3":this.$router.push("/message");break;case"4":this.$router.push("/mine")}}}},Z={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("el-menu",{staticClass:"menu",attrs:{mode:"horizontal","text-color":"#66757f","active-text-color":"#409EFF","default-active":t.activeIndex},on:{select:t.handleMenu}},[s("el-col",{attrs:{span:6}},[s("el-menu-item",{attrs:{index:"1"}},[t._v("首页")])],1),t._v(" "),s("el-col",{attrs:{span:6}},[s("el-menu-item",{attrs:{index:"2"}},[t._v("搜索")])],1),t._v(" "),s("el-col",{attrs:{span:6}},[s("el-menu-item",{attrs:{index:"3"}},[t._v("消息\n          "),t.unreadMsgLength>0?s("el-badge",{attrs:{value:t.unreadMsgLength}}):t._e()],1)],1),t._v(" "),s("el-col",{attrs:{span:6}},[s("el-menu-item",{attrs:{index:"4"}},[t._v("我的")])],1)],1),t._v(" "),s("div",{staticClass:"block"})],1)},staticRenderFns:[]};var K=s("VU/8")(X,Z,!1,function(t){s("WAQq")},"data-v-23bfafe4",null).exports,tt={name:"home",components:{"v-menu":K,"v-new-list":Y},data:function(){return{menuIndex:"1",page:1,startx:0,starty:0,endx:0,endy:0,count1:0,count2:0}},created:function(){var t=this;window.addEventListener("beforeunload",function(t){window.localStorage.removeItem("productList")}),window.localStorage.productList||(console.log("actioget"),this.actionGetList(this.page)),document.addEventListener("touchstart",function(e){t.startx=e.touches[0].pageX,t.starty=e.touches[0].pageY}),document.addEventListener("touchmove",function(e){t.endx=e.changedTouches[0].pageX,t.endy=e.changedTouches[0].pageY;var s=t.getDirection(t.startx,t.starty,t.endx,t.endy),i=document.querySelector(".add"),n=document.querySelector(".el-icon-plus");switch(s){case 1:i.style.opacity=0,i.style.width="0px",i.style.height="0px",n.style.opacity=0,n.style.width="0px",n.style.height="0px";break;case 2:i.style.opacity=1,i.style.width="50px",i.style.height="50px",n.style.opacity=1,n.style.width="14px",n.style.height="14px"}})},computed:u()({},Object(d.c)(["productList","userinfo","loadState"])),methods:u()({},Object(d.b)(["actionGetList"]),{publish:function(){this.$router.push("/publish")},loadMore:function(){},getDirection:function(t,e,s,i){var n=s-t,a=i-e,o=0;if(Math.abs(n)<2&&Math.abs(a)<2)return o;var r=180*Math.atan2(a,n)/Math.PI;return r>=-135&&r<=-45?o=1:r>45&&r<135&&(o=2),o},throttle:function(t,e,s){var i=void 0,n=new Date;return function(){var a=this,o=Array.prototype.slice.call(arguments),r=new Date;clearTimeout(i),r-n>=s?(t.apply(a,o),n=r):i=setTimeout(function(){t.apply(a,o)},e)}},lazyLoad:function(){var t=document.documentElement.clientHeight,e=document.documentElement.scrollTop;document.querySelector(".block2").offsetTop<t+e+100&&0!==this.loadState&&this.loadMore();for(var s=B()(document.querySelectorAll(".tao-left .image")),i=B()(document.querySelectorAll(".tao-right .image")),n=this.count1;n<s.length;n++)s[n].offsetTop<t+e&&(this.count1++,s[n].src=s[n].getAttribute("data-src"));for(var a=this.count2;a<i.length;a++)i[a].offsetTop<t+e&&(this.count2++,i[a].src=i[a].getAttribute("data-src"))}}),mounted:function(){var t=this;setTimeout(function(){for(var e=document.documentElement.clientHeight,s=B()(document.querySelectorAll(".tao-left .image")),i=B()(document.querySelectorAll(".tao-right .image")),n=t.count1;n<s.length;n++)s[n].offsetTop<e&&(t.count1++,s[n].src=s[n].getAttribute("data-src"));for(var a=t.count2;a<i.length;a++)i[a].offsetTop<e&&(t.count2++,i[a].src=i[a].getAttribute("data-src"))},1e3),document.addEventListener("scroll",this.throttle(this.lazyLoad,500,1e3))}},et={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"main"},[s("v-menu",{attrs:{activeIndex:t.menuIndex}}),t._v(" "),s("div",{staticClass:"tao"},[s("div",{staticClass:"tao-left"},t._l(t.productList,function(e,i){return s("div",{key:i,staticClass:"lists"},[1==(1&i)?s("v-new-list",{attrs:{list:e}}):t._e()],1)}),0),t._v(" "),s("div",{staticClass:"tao-right"},t._l(t.productList,function(e,i){return s("div",{key:i,staticClass:"lists"},[0==(1&i)?s("v-new-list",{attrs:{list:e}}):t._e()],1)}),0)]),t._v(" "),s("el-button",{staticClass:"add",attrs:{icon:"el-icon-plus",type:"primary",circle:""},on:{click:function(e){t.publish()}}}),t._v(" "),s("div",{staticClass:"block2"},[2===t.loadState?s("p",[s("i",{staticClass:"el-icon-loading"})]):t._e(),t._v(" "),-1===t.loadState?s("p",[t._v("加载失败")]):t._e(),t._v(" "),0===t.loadState?s("p",[t._v("到底啦")]):t._e()])],1)},staticRenderFns:[]};var st=s("VU/8")(tt,et,!1,function(t){s("WBol")},"data-v-420938f2",null).exports,it={name:"commonList",props:{list:Object,index:Number},data:function(){return{imgName:""}},created:function(){this.imgName="image"+this.index},mounted:function(){var t=document.querySelector("."+this.imgName);t.style.width="100%",t.style.height=t.offsetWidth+"px"},methods:{showDetail:function(){window.localStorage.setItem("detail",n()(this.list)),this.$router.push("/detail")}}},nt={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{on:{click:function(e){t.showDetail()}}},[s("el-card",{attrs:{"body-style":{padding:"0px"}}},[s("img",{class:t.imgName,attrs:{src:t.list.pic[0]}}),t._v(" "),s("div",{staticStyle:{padding:"5px","text-align":"left"}},[s("div",{staticClass:"title"},[t._v(t._s(t.list.name))]),t._v(" "),s("div",{staticClass:"price"},[t._v("￥"+t._s(t.list.price))]),t._v(" "),s("div",{staticClass:"time"},[t._v(t._s(t.list.publish_time))])])])],1)},staticRenderFns:[]};var at=s("VU/8")(it,nt,!1,function(t){s("lGZc")},"data-v-c0da4b8c",null).exports,ot={name:"commonLists",props:{list:Object},components:{"v-common-list":at}},rt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tao"},this._l(this.lists,function(t,s){return e("div",{key:t.pic,staticClass:"lists",staticStyle:{width:"49%"}},[e("v-common-list",{attrs:{list:t,index:s}})],1)}),0)},staticRenderFns:[]};var ct=s("VU/8")(ot,rt,!1,function(t){s("+IYe")},"data-v-14ccd04c",null).exports,lt={name:"search",components:{"v-menu":K,"v-common-lists":ct},data:function(){return{menuIndex:"2",input:""}},computed:u()({},Object(d.c)(["searchList"])),methods:u()({},Object(d.b)(["actionSearch"]),{search:function(){console.log(this.input),this.actionSearch(this.input)},back:function(){history.back()}})},ut={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"main"},[s("el-input",{staticClass:"search",attrs:{placeholder:"请输入内容"},model:{value:t.input,callback:function(e){t.input=e},expression:"input"}},[s("el-button",{attrs:{slot:"prepend",icon:"el-icon-arrow-left"},on:{click:function(e){t.back()}},slot:"prepend"}),t._v(" "),s("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(e){t.search()}},slot:"append"})],1),t._v(" "),s("v-common-lists",{attrs:{lists:t.searchList}}),t._v(" "),s("div",{staticClass:"block2"})],1)},staticRenderFns:[]};var dt=s("VU/8")(lt,ut,!1,function(t){s("SW9u")},"data-v-29893bad",null).exports,ht={name:"chatCard",props:{list:Object},data:function(){return{}},computed:u()({},Object(d.c)(["unreadMsgLength","group_name"])),methods:u()({},Object(d.b)(["actionSetChatToUser","actionReduceUnreadMsg","actionSetGroupName","actionChangeReadState"]),{chatDetail:function(){var t=this.list.msg.length-this.list.unreadCount,e={user_id:this.list.user_id,username:this.list.username,avatar_url:this.list.avatar_url};this.actionSetGroupName(this.list.user_id),this.actionSetChatToUser(e),this.actionReduceUnreadMsg(this.list.unreadCount),this.actionChangeReadState(this.list.username);for(var s=[],i=t;i<this.list.msg.length;i++){var a={name:this.list.username,msg:this.list.msg[i].words,avatar:this.list.avatar_url,time:this.list.msg[i].time};s.push(a)}var o=JSON.parse(window.localStorage.getItem(this.group_name));o?(o=o.concat(s),window.localStorage.setItem(this.group_name,n()(o))):window.localStorage.setItem(this.group_name,n()(s)),this.$router.push("/chat")}})},mt={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"clearfix",on:{click:function(e){t.chatDetail()}}},[s("div",{staticClass:"img-tao"},[0!=t.list.unreadCount?s("el-badge",{attrs:{value:t.list.unreadCount}},[s("img",{staticClass:"user-head",attrs:{src:t.list.avatar_url}})]):s("img",{staticClass:"user-head",attrs:{src:t.list.avatar_url}})],1),t._v(" "),s("div",{staticClass:"tao"},[s("div",{staticClass:"user-name"},[t._v(t._s(t.list.username))]),t._v(" "),s("div",{staticClass:"time"},[t._v(t._s(t.list.msg[t.list.msg.length-1].words))])]),t._v(" "),s("span",{staticClass:"price"},[t._v(t._s(t.list.msg[t.list.msg.length-1].time.split(" ")[0]))])])},staticRenderFns:[]};var gt={name:"message",components:{"v-chat-card":s("VU/8")(ht,mt,!1,function(t){s("r5T3")},"data-v-7d0475d0",null).exports,"v-menu":K},data:function(){return{menuIndex:"3"}},computed:u()({},Object(d.c)(["historyMsg"]))},pt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("v-menu",{attrs:{activeIndex:this.menuIndex}}),this._v(" "),this._l(this.historyMsg,function(t,s){return e("div",{staticClass:"lists"},[e("v-chat-card",{attrs:{list:t}})],1)})],2)},staticRenderFns:[]},ft=s("VU/8")(gt,pt,!1,null,null,null).exports,vt={name:"mine",components:{"v-menu":K,"v-upload":$},data:function(){return{menuIndex:"4",userinfo:{}}},created:function(){this.userinfo=JSON.parse(window.localStorage.getItem("userinfo"))},methods:u()({},Object(d.b)(["actionCloseMessagePush","actionClearMsgRecord"]),{changeAvatar:function(){this.$router.push("/changeAvatar")},changePassword:function(){this.$router.push("/changePassword")},myCollection:function(){this.$router.push("/myCollection")},myPublish:function(){this.$router.push("/myPublish")},signOut:function(){this.actionCloseMessagePush(),window.localStorage.clear(),window.location.reload()}})},_t={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"main"},[s("v-menu",{attrs:{activeIndex:t.menuIndex}}),t._v(" "),s("div",{staticClass:"clearfix"},[s("img",{staticClass:"user-head",attrs:{src:t.userinfo.user_image_url},on:{click:function(e){t.changeAvatar()}}}),t._v(" "),s("span",{staticClass:"user-name"},[t._v(t._s(t.userinfo.username))])]),t._v(" "),s("div",{staticClass:"select my-collection",on:{click:function(e){t.myCollection()}}},[s("span",{staticClass:"left"},[t._v("我的预约")]),t._v(" "),s("i",{staticClass:"el-icon-star-on right"})]),t._v(" "),s("div",{staticClass:"select my-publish",on:{click:function(e){t.myPublish()}}},[s("span",{staticClass:"left"},[t._v("我的发布")]),t._v(" "),s("i",{staticClass:"el-icon-edit-outline right"})]),t._v(" "),s("div",{staticClass:"select change-password",on:{click:function(e){t.changePassword()}}},[s("span",{staticClass:"left"},[t._v("修改密码")]),t._v(" "),s("i",{staticClass:"el-icon-setting right"})]),t._v(" "),s("el-button",{attrs:{type:"danger"},on:{click:function(e){t.signOut()}}},[t._v("退出登录")])],1)},staticRenderFns:[]};var bt=s("VU/8")(vt,_t,!1,function(t){s("BCnH")},"data-v-58a293e8",null).exports,wt={name:"publish",components:{"v-header":q,"v-upload":$,"v-load":G},data:function(){return{headerMsg:{centerWord:"发布",leftImg:"/static/images/back.png",rightImg:"/static/images/check.png"},limit:"4",multiple:!0,price:"",description:"",title:"",imgsList:[],img1:null,img2:null,img3:null,img4:null,uploadSuccesMsg:"发布成功",uploadErrorMsg:"发布失败"}},computed:u()({},Object(d.c)(["imgName","userinfo","publishState","qiniuaddr","allImgUploadState"]),{watchImgState:function(){if(1===this.allImgUploadState){switch(this.imgName.length){case 4:this.img4=this.imgName[3].split("||")[0];case 3:this.img3=this.imgName[2].split("||")[0];case 2:this.img2=this.imgName[1].split("||")[0];case 1:this.img1=this.imgName[0].split("||")[0]}var t={username:this.userinfo.username,goods_price:this.price,title:this.title,description:this.description,goods_img1:this.img1,goods_img2:this.img2,goods_img3:this.img3,goods_img4:this.img4,first_img_width_height:this.imgName[0].split("||")[1]};this.actionPublish(t)}else-1===this.allImgUploadState&&this.actionPublishError()}}),methods:u()({},Object(d.d)(["notPublish","publishing"]),Object(d.b)(["actionPublish","actionClearImgInfo","actionPublishError"]),{checkMessage:function(){return this.title&&this.description&&this.price&&this.imgName?this.title.length>40||this.description.length>300||this.price.length>8?(this.$message({message:"填写的信息过长",center:!0}),0):1:(this.$message({message:"信息填写不完整",center:!0}),0)},headerLeft:function(){history.back()},afterLoading:function(){this.actionClearImgInfo(),this.notPublish(),history.back()},headerRight:function(){this.checkMessage()&&(this.publishing(),this.$refs.imgUpload.uploadImg())}})},yt={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"main"},[s("v-header",{attrs:{headerMsg:t.headerMsg}}),t._v(" "),s("el-card",{staticClass:"box-card"},[s("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],staticClass:"title",attrs:{type:"text",placeholder:"请输入标题"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}})]),t._v(" "),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],attrs:{type:"text",placeholder:"内容描述..."},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}}),t._v(" "),s("v-upload",{ref:"imgUpload",attrs:{limit:t.limit,multiple:t.multiple}}),t._v(t._s(t.watchImgState)+"\n    ")],1),t._v(" "),s("div",{staticClass:"price"},[s("span",[t._v("价格：")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.price,expression:"price"}],attrs:{type:"number",placeholder:"请输入价格"},domProps:{value:t.price},on:{input:function(e){e.target.composing||(t.price=e.target.value)}}})]),t._v(" "),s("div",{staticClass:"block"}),t._v(" "),s("v-load",{attrs:{successMsg:t.uploadSuccesMsg,errorMsg:t.uploadErrorMsg}})],1)},staticRenderFns:[]};var Ct=s("VU/8")(wt,yt,!1,function(t){s("gPHc")},"data-v-3a24449c",null).exports,St={name:"list",components:{"v-header":q},data:function(){return{list:{},headerMsg:{centerWord:"详情",leftImg:"/static/images/back.png",rightImg:"",centerImg:"/static/images/message.png"},nowCollectState:!1}},created:function(){this.list=JSON.parse(window.localStorage.getItem("detail")),this.nowCollectState=this.list.collect_state},computed:{watchCollectState:function(){this.nowCollectState?this.headerMsg.rightImg="/static/images/favor_fill.png":this.headerMsg.rightImg="/static/images/favor.png"}},methods:u()({},Object(d.b)(["actionChangeCollectState","actionSetChatToUser","actionSetGroupName"]),{headerLeft:function(){if(this.nowCollectState!=this.list.collect_state){var t={product_id:this.list.product_id,collect_state:this.nowCollectState};this.actionChangeCollectState(t)}window.localStorage.removeItem("detail"),history.back()},headerRight:function(){this.nowCollectState=!this.nowCollectState,this.nowCollectState&&this.$message({message:"收藏成功！",type:"success",duration:2e3})},headerCenter:function(){var t={user_id:this.list.user_id,username:this.list.username,avatar_url:this.list.avatar_url};this.actionSetGroupName(this.list.user_id),this.actionSetChatToUser(t),this.$router.push("/chat")}})},kt={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"main"},[s("v-header",{attrs:{headerMsg:t.headerMsg}}),t._v(t._s(t.watchCollectState)+"\n  "),s("div",{staticClass:"box-card"},[s("div",{staticClass:"clearfix"},[s("div",{staticClass:"tao"},[s("div",{staticClass:"user-name"},[t._v(t._s(t.list.stuId))]),t._v(" "),s("div",{staticClass:"time"},[t._v(t._s(t.list.publish_time))])]),t._v(" "),s("span",{staticClass:"price"},[t._v("￥"+t._s(t.list.price))])]),t._v(" "),s("div",{staticClass:"title"},[t._v(t._s(t.list.name))]),t._v(" "),s("div",{staticClass:"description"},[t._v(t._s(t.list.description))]),t._v(" "),t._l(t.list.pics,function(t,e){return s("div",{key:e,staticClass:"images"},[s("el-image",{attrs:{src:t.pic}})],1)})],2),t._v(" "),s("div",{staticClass:"block"})],1)},staticRenderFns:[]};var xt=s("VU/8")(St,kt,!1,function(t){s("EqrD")},"data-v-554b9a63",null).exports,It={name:"changeAvatar",components:{"v-header":q,"v-upload":$,"v-loading":G},data:function(){return{headerMsg:{centerWord:"上传头像",leftImg:"/static/images/back.png",rightImg:"/static/images/check.png"},limit:"1",multiple:!1,imgsList:[],uploadSuccesMsg:"上传成功",uploadErrorMsg:"上传失败"}},computed:u()({},Object(d.c)(["imgName","userinfo","publishState","qiniuaddr","allImgUploadState"]),{watchImgState:function(){if(1===this.allImgUploadState){var t={user_image_url:this.imgName[0].split("||")[0]};this.actionChangeAvatar(t)}else-1===this.allImgUploadState&&this.actionPublishError()}}),methods:u()({},Object(d.b)(["actionChangeAvatar","actionClearImgInfo","actionPublishError"]),Object(d.d)(["notPublish","publishing"]),{headerLeft:function(){history.back()},afterLoading:function(){this.actionClearImgInfo(),this.notPublish(),history.back()},headerRight:function(){this.publishing(),this.$refs.imgUpload.uploadImg()}})},Mt={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("v-header",{attrs:{headerMsg:t.headerMsg}}),t._v(" "),s("v-upload",{ref:"imgUpload",staticClass:"v-upload",attrs:{limit:t.limit,multiple:t.multiple}}),t._v(t._s(t.watchImgState)+"\n  "),s("v-loading",{attrs:{successMsg:t.uploadSuccesMsg,errorMsg:t.uploadErrorMsg}})],1)},staticRenderFns:[]};var Lt=s("VU/8")(It,Mt,!1,function(t){s("IlTn")},"data-v-9570430e",null).exports,jt={name:"changePassword",components:{"v-header":q,"v-loading":G},data:function(){return{headerMsg:{centerWord:"修改密码",leftImg:"/static/images/back.png",rightImg:"/static/images/check.png"},firstPassword:"",secondPassword:"",modifySuccessMsg:"修改成功，请重新登录",modifyErrorMsg:"修改失败"}},methods:u()({},Object(d.d)(["notPublish","publishing"]),Object(d.b)(["actionChangePassword","actionCloseMessagePush"]),{headerLeft:function(){history.back()},afterLoading:function(){this.notPublish(),this.actionCloseMessagePush(),window.localStorage.clear(),this.$router.push("/")},checkMessage:function(){return this.firstPassword!=this.secondPassword?(this.$message.error("两次密码不一致"),0):1},headerRight:function(){if(this.checkMessage()){this.publishing();var t={password:this.firstPassword};this.actionChangePassword(t)}}})},Pt={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("v-header",{attrs:{headerMsg:t.headerMsg}}),t._v(" "),s("div",{staticClass:"contain"},[s("el-input",{attrs:{placeholder:"请输入新密码",type:"password"},model:{value:t.firstPassword,callback:function(e){t.firstPassword=e},expression:"firstPassword"}}),t._v(" "),s("el-input",{attrs:{placeholder:"请再次输入新密码",type:"password"},model:{value:t.secondPassword,callback:function(e){t.secondPassword=e},expression:"secondPassword"}})],1),t._v(" "),s("v-loading",{attrs:{successMsg:t.modifySuccessMsg,errorMsg:t.modifyErrorMsg}})],1)},staticRenderFns:[]};var Ut=s("VU/8")(jt,Pt,!1,function(t){s("uS/u")},"data-v-2f210551",null).exports,Rt={name:"myCollection",components:{"v-header":q,"v-common-lists":ct},data:function(){return{headerMsg:{centerWord:"我的收藏",leftImg:"/static/images/back.png"}}},created:function(){this.actionGetCollectionList()},computed:u()({},Object(d.c)(["collectionList"])),methods:u()({},Object(d.b)(["actionGetCollectionList"]),{headerLeft:function(){history.back()}})},Et={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("v-header",{attrs:{headerMsg:this.headerMsg}}),this._v(" "),e("v-common-lists",{attrs:{lists:this.collectionList}}),this._v(" "),e("div",{staticClass:"block2"})],1)},staticRenderFns:[]};var Ot=s("VU/8")(Rt,Et,!1,function(t){s("hV7k")},"data-v-0f7c57e2",null).exports,Nt={name:"myPublish",components:{"v-header":q,"v-common-lists":ct},data:function(){return{headerMsg:{centerWord:"我的发布",leftImg:"/static/images/back.png"}}},created:function(){console.log("created"),this.actionGetMyPublishList()},computed:u()({},Object(d.c)(["myPublishList"])),methods:u()({},Object(d.b)(["actionGetMyPublishList"]),{headerLeft:function(){history.back()}})},$t={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("v-header",{attrs:{headerMsg:this.headerMsg}}),this._v(" "),e("v-common-lists",{attrs:{lists:this.myPublishList}}),this._v(" "),e("div",{staticClass:"block2"})],1)},staticRenderFns:[]};var Tt=s("VU/8")(Nt,$t,!1,function(t){s("wG1d")},"data-v-7a3a6f17",null).exports,At={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"item-right"},[s("div",{staticClass:"name-right"},[s("span",[t._v(t._s(t.mytime))])]),t._v(" "),s("img",{staticClass:"avatar-right",attrs:{src:t.avatar,alt:""}}),t._v(" "),t.msg?s("span",[t._v("\n        "+t._s(t.msg)+"\n    ")]):t._e()])},staticRenderFns:[]};var qt={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"item-left"},[s("div",{staticClass:"name-left"},[s("span",[t._v(t._s(t.mytime))])]),t._v(" "),s("img",{staticClass:"avatar-left",attrs:{src:t.avatar,alt:""}}),t._v(" "),t.msg?s("span",[t._v("\n        "+t._s(t.msg)+"\n    ")]):t._e()])},staticRenderFns:[]};var Wt={name:"chat",components:{"v-my-msg":s("VU/8")({props:["msg","mytime","avatar"],computed:{}},At,!1,function(t){s("ZHhl")},"data-v-1bccccec",null).exports,"v-other-msg":s("VU/8")({props:["msg","mytime","avatar"],computed:{}},qt,!1,function(t){s("J7no")},"data-v-a79ed1e4",null).exports,"v-header":q},data:function(){return{input:"",myUserInfo:{},headerMsg:{centerWord:"",leftImg:"/static/images/back.png"},container:{},websock:null,msgRecord:[]}},created:function(){this.myUserInfo=JSON.parse(window.localStorage.getItem("userinfo")),this.headerMsg.centerWord=this.chatToUser.username,this.initWebSocket();var t=JSON.parse(window.localStorage.getItem(this.group_name));t&&(this.msgRecord=t),Date.prototype.Format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var s in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[s]:("00"+e[s]).substr((""+e[s]).length)));return t}},computed:u()({},Object(d.c)(["chatToUser","group_name"])),destroyed:function(){this.websock.close()},mounted:function(){var t=this;this.container=document.querySelector(".chat-content");var e=window.innerHeight,s=document.querySelector(".el-input").offsetHeight;this.container.style.height=e-s-50+"px",this.$nextTick(function(){t.container.scrollTop=t.container.scrollHeight})},methods:u()({},Object(d.b)(["actionClearGroupName"]),{initWebSocket:function(){var t="ws://127.0.0.1:8000/ws/chat/"+this.group_name+"/";this.websock=new WebSocket(t),this.websock.onmessage=this.websocketonmessage,this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onclose=this.websocketclose},websocketonopen:function(){console.log("WebSocket连接成功")},websocketonerror:function(t){console.log("连接失败的信息："+t),this.initWebSocket()},websocketonmessage:function(t){var e=this,s=JSON.parse(t.data);if(s.from_user==this.chatToUser.user_id){var i={name:this.chatToUser.username,msg:s.message,avatar:this.chatToUser.avatar_url,time:s.time};this.msgRecord.push(i),this.$nextTick(function(){e.container.scrollTop=e.container.scrollHeight})}else s.from_user==this.myUserInfo.id?console.log("消息发送成功"):console.log("返回未知消息")},websocketsend:function(){var t=this,e=(new Date).Format("yyyy-MM-dd hh:mm:ss"),s={from_user:this.myUserInfo.id,to_user:this.chatToUser.user_id,message:this.input,time:e};this.websock.send(n()(s)),s={name:this.myUserInfo.username,msg:this.input,avatar:this.myUserInfo.user_image_url,time:e},this.msgRecord.push(s),this.$nextTick(function(){t.container.scrollTop=t.container.scrollHeight}),this.input=""},websocketclose:function(t){console.log("断开连接",t)},headerLeft:function(){this.websocketclose(),window.localStorage.setItem(this.group_name,n()(this.msgRecord)),this.actionClearGroupName(),history.back()}})},Ft={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("v-header",{attrs:{headerMsg:t.headerMsg}}),t._v(" "),s("div",{staticClass:"chat-content"},t._l(t.msgRecord,function(e){return s("div",[e.name==t.myUserInfo.username?s("v-my-msg",{attrs:{msg:e.msg,avatar:e.avatar,mytime:e.time}}):s("v-other-msg",{attrs:{msg:e.msg,avatar:e.avatar,mytime:e.time}})],1)}),0),t._v(" "),s("el-input",{model:{value:t.input,callback:function(e){t.input=e},expression:"input"}},[s("el-button",{attrs:{slot:"append"},on:{click:function(e){t.websocketsend()}},slot:"append"},[t._v("发送")])],1)],1)},staticRenderFns:[]};var Gt=s("VU/8")(Wt,Ft,!1,function(t){s("QgLQ")},"data-v-f05ea9b8",null).exports;a.default.use(c.a);var Ht=new c.a({routes:[{path:"/",name:"login",component:g},{path:"/register",name:"register",component:D},{path:"/home",name:"home",component:st,meta:{requireAuth:!0,keepAlive:!0}},{path:"/search",name:"search",component:dt,meta:{requireAuth:!0}},{path:"/message",name:"message",component:ft,meta:{requireAuth:!0}},{path:"/mine",name:"mine",component:bt,meta:{requireAuth:!0}},{path:"/changeAvatar",name:"changeAvatar",component:Lt,meta:{requireAuth:!0}},{path:"/publish",name:"publish",component:Ct,meta:{requireAuth:!0}},{path:"/detail",name:"detail",component:xt,meta:{requireAuth:!0}},{path:"/changePassword",name:"changePassword",component:Ut,meta:{requireAuth:!0}},{path:"/myCollection",name:"myCollection",component:Ot,meta:{requireAuth:!0}},{path:"/myPublish",name:"myPublish",component:Tt,meta:{requireAuth:!0}},{path:"/chat",name:"chat",component:Gt,meta:{requireAuth:!0}}]}),Vt=s("zL8q"),Dt=s.n(Vt),Jt=(s("tvR6"),{hasLogin:!1,domain:"https://upload-z2.qiniup.com",qiniuaddr:"qiniu.fanfei.site",errorLogin:{},userinfo:{},productList:[],errorRegister:{},hasRegister:!1,registering:!1,imgName:[],publishState:0,loadState:1,searchList:[],collectionList:[],myPublishList:[],chatToUser:{},historyMsg:[],messagePush:null,group_name:"",unreadMsgLength:0}),Bt=s("cpGA"),Qt={hasLogin:function(t,e){t.userinfo=e,window.localStorage.setItem("userinfo",n()(e)),window.localStorage.setItem("token",e.token),t.hasLogin=!0},notLogin:function(t){t.hasLogin=!1},loginError:function(t,e){t.errorLogin=e,setTimeout(function(){t.errorLogin=""},1e3)},hasRegister:function(t){t.hasRegister=!0},registering:function(t,e){t.registering=e},registerError:function(t,e){t.errorRegister=e},setUserinfo:function(t,e){t.userinfo=e,window.localStorage.setItem("userinfo",n()(e))},changeAvatar:function(t,e){t.userinfo.user_image_url=e,window.localStorage.setItem("userinfo",n()(t.userinfo))},clearUserinfo:function(t){t.userinfo={},window.localStorage.removeItem("userinfo")},getProductList:function(t,e){console.log(t,e),t.productList=t.productList.concat(e),console.log(t.productList),window.localStorage.setItem("productList",n()(t.productList))},getSearchList:function(t,e){t.searchList=e},getCollectionList:function(t,e){t.collectionList=e},getMyPublishList:function(t,e){t.myPublishList=e},changeCollectState:function(t,e){var s=t.productList.findIndex(function(t){return t.product_id=e.product_id});-1!==s&&(t.productList[s].collect_state=e.collect_state)},uploadImg:function(t,e){var s={useCdnDomain:!0,region:Bt.region.z2},i={fname:e.param.file.name,params:{},mimeType:["image/png","image/jpeg","image/gif"]},n={next:function(t){},error:function(t){console.log("图片上传错误信息："+t.message)},complete:function(s){console.log("图片上传成功："+s.key),t.imgName.push(s.key+"||"+e.imgWidthHeight)}};Bt.upload(e.param.file,e.key,e.token,i,s).subscribe(n)},clearImgInfo:function(t){t.allImgUploadState=0,t.imgName=[]},publishSuccess:function(t){t.publishState=1},publishError:function(t){t.publishState=-1},notPublish:function(t){t.publishState=0},publishing:function(t){t.publishState=2},loadMore:function(t){t.loadState=1},loadFinish:function(t){t.loadState=0},loadError:function(t){t.loadState=-1},loading:function(t){t.loadState=2},setChatToUser:function(t,e){t.chatToUser=e},initMessagePush:function(t,e){t.messagePush=new WebSocket(e),t.messagePush.onopen=function(){console.log("消息推送开启")}},messagePushOnMessage:function(t){t.messagePush.onmessage=function(e){t.unreadMsgLength++;var s=JSON.parse(e.data).event,i=!1,n={words:s.message,time:s.time};for(var a in t.historyMsg)if(t.historyMsg[a].username==s.from_username){t.historyMsg[a].msg.push(n),t.historyMsg[a].unreadCount++,i=!0;break}if(!i){var o={user_id:s.from_user,username:s.from_username,avatar_url:s.avatar_url,msg:[n],unreadCount:1};t.historyMsg.push(o)}}},messagePushOnError:function(t,e){t.messagePush.onerror=function(t){console.log("消息推送连接失败的信息："+t)}},messagePushOnClose:function(t){t.messagePush.onclose=function(t){console.log("消息推送断开连接")}},closeMessagePush:function(t){t.messagePush.close()},reduceUnreadMsg:function(t,e){t.unreadMsgLength-=e},recoverHistoryMsg:function(t,e){t.historyMsg=e},recoverUnreadMsgLength:function(t,e){t.unreadMsgLength=e},setGroupName:function(t,e){var s=JSON.parse(window.localStorage.getItem("userinfo")).id,i=e;t.group_name=s-i<0?s+"_"+i:i+"_"+s},clearGroupName:function(t){t.group_name=""},changeReadState:function(t,e){for(var s in t.historyMsg)if(t.historyMsg[s].username==e){t.historyMsg[s].unreadCount=0;break}},clearMsgRecord:function(t){t.historyMsg=[],t.unreadMsgLength=0}},zt={hasLogin:function(t){return t.hasLogin},errorLogin:function(t){return t.errorLogin},errorRegister:function(t){return t.errorRegister},hasRegister:function(t){return t.hasRegister},registering:function(t){return t.registering},userinfo:function(t){return t.userinfo},imgName:function(t){return t.imgName},allImgUploadState:function(t){return t.allImgUploadState},publishState:function(t){return t.publishState},domain:function(t){return t.domain},qiniuaddr:function(t){return t.qiniuaddr},productList:function(t){return console.log("getter productList"),console.log(t.productList),t.productList},default_avatar_url:function(t){return t.default_avatar_url},homePage:function(t){return t.homePage},loadState:function(t){return t.loadState},searchList:function(t){return t.searchList},collectionList:function(t){return t.collectionList},myPublishList:function(t){return t.myPublishList},chatToUser:function(t){return t.chatToUser},messagePush:function(t){return t.messagePush},historyMsg:function(t){return t.historyMsg},unreadMsgLength:function(t){return t.unreadMsgLength},group_name:function(t){return t.group_name},imgWidthHeight:function(t){return t.imgWidthHeight}},Yt=s("YW59"),Xt={actionLogin:function(t,e){var s=t.commit;S(e).then(function(t){console.log(t),e.stuId===t.stuId?(console.log("dsafs"),s("hasLogin",e.password)):s("loginError",e.password)},function(t){console.log("登录错误信息："+t),s("loginError","未知错误")})},actionNotLogin:function(t){(0,t.commit)("notLogin")},actionRegister:function(t,e){var s=t.commit;console.log(e),s("registering",!0),console.log(e),k(e).then(function(t){return console.log(t),s("registering",!1),Yt.error},function(t){s("registering",!1),s("registerError","未知错误"),s("publishError"),console.log("注册错误信息："+t)})},actionGetList:function(t,e){var s=t.commit;s("loading"),L(e).then(function(t){console.log(t),200==t.status?(s("getProductList",t.data.results),s("loadMore")):201==t.status?(s("loadError"),console.log("您没有访问权限")):s("loadError")},function(t){404===t.response.status?s("loadFinish"):(s("loadError"),console.log("获取商品列表失败："+t))})},actionSearch:function(t,e){var s=t.commit;j(e).then(function(t){200==t.stateCode&&s("getSearchList",t.list)},function(t){console.log("搜索失败")})},actionChangeCollectState:function(t,e){(0,t.commit)("changeCollectState",e),R(e).then(function(t){200===t.stateCode?console.log("收藏状态改变成功"):console.log("您没有操作权限")},function(t){console.log("收藏状态操作失败")})},actionGetUploadToken:function(t,e){var s=t.commit,i={filetype:e.filetype};x(i).then(function(t){200===t.stateCode&&s("uploadImg",{token:t.token,key:t.key,param:e.param,imgWidthHeight:e.imgWidthHeight})},function(t){console.log("获取图片上传凭证错误："+t),s("uploadImgError")})},actionUploadSuccess:function(t){(0,t.commit)("uploadImgSuccess")},actionClearImgInfo:function(t){(0,t.commit)("clearImgInfo")},actionPublish:function(t,e){var s=t.commit;P(e).then(function(t){200===t.stateCode?s("publishSuccess"):s("publishError")},function(t){s("publishError"),console.log("发布失败")})},actionPublishError:function(t){(0,t.commit)("publishError")},actionChangeAvatar:function(t,e){var s=t.commit;I(e).then(function(t){200===t.stateCode?(console.log("头像上传成功"),s("changeAvatar",t.msg.user_image_url),s("publishSuccess")):s("publishError")},function(t){s("publishError"),console.log("头像上传失败")})},actionChangePassword:function(t,e){var s=t.commit;M(e).then(function(t){200===t.stateCode?(console.log("修改密码成功"),s("clearUserinfo"),s("publishSuccess")):(s("publishError"),console.log("密码修改失败"))},function(t){s("publishError"),console.log("密码修改失败")})},actionGetCollectionList:function(t){var e=t.commit;E().then(function(t){200===t.stateCode&&e("getCollectionList",t.list)},function(t){console.log("获取收藏列表失败"+t)})},actionGetMyPublishList:function(t){var e=t.commit;U().then(function(t){console.log(t),200===t.stateCode&&e("getMyPublishList",t.list)},function(t){console.log("获取收藏列表失败"+t)})},actionSetChatToUser:function(t,e){(0,t.commit)("setChatToUser",e)},actionInitMessagePush:function(t,e){var s=t.commit;s("initMessagePush",e),s("messagePushOnMessage"),s("messagePushOnError",e),s("messagePushOnClose")},actionCloseMessagePush:function(t){(0,t.commit)("closeMessagePush")},actionReduceUnreadMsg:function(t,e){(0,t.commit)("reduceUnreadMsg",e)},actionSetGroupName:function(t,e){(0,t.commit)("setGroupName",e)},actionClearGroupName:function(t){(0,t.commit)("clearGroupName")},actionChangeReadState:function(t,e){(0,t.commit)("changeReadState",e)},actionClearMsgRecord:function(t){(0,t.commit)("clearMsgRecord")}};a.default.use(d.a);var Zt=new d.a.Store({state:Jt,mutations:Qt,getters:zt,actions:Xt});a.default.config.productionTip=!1,a.default.prototype.$http=C.a,a.default.use(Dt.a),window.localStorage.token&&Zt.commit("setUserinfo",JSON.parse(window.localStorage.getItem("userinfo"))),window.localStorage.unreadMsgLength&&(Zt.commit("recoverHistoryMsg",JSON.parse(window.localStorage.getItem("historyMsg"))),Zt.commit("recoverUnreadMsgLength",Number(JSON.parse(window.localStorage.getItem("unreadMsgLength"))))),Ht.beforeEach(function(t,e,s){if(0!=Zt.getters.historyMsg.length&&(window.localStorage.setItem("historyMsg",n()(Zt.getters.historyMsg)),window.localStorage.setItem("unreadMsgLength",Zt.getters.unreadMsgLength)),t.meta.requireAuth){if(!Zt.getters.messagePush){var i=JSON.parse(window.localStorage.getItem("userinfo"));if(i){var a="ws://127.0.0.1:8000/push/"+i.id+"/";Zt.dispatch("actionInitMessagePush",a)}}window.localStorage.getItem("token")?s():(console.log("token不存在"),s({path:"/"}))}else s()}),new a.default({el:"#app",router:Ht,store:Zt,components:{App:r},template:"<App/>"})},"O/+H":function(t,e){},QgLQ:function(t,e){},SW9u:function(t,e){},WAQq:function(t,e){},WBol:function(t,e){},X9qx:function(t,e){},ZHhl:function(t,e){},"e1/e":function(t,e){},ejIq:function(t,e){},gPHc:function(t,e){},hV7k:function(t,e){},jvYL:function(t,e){},lGZc:function(t,e){},r5T3:function(t,e){},tvR6:function(t,e){},"uS/u":function(t,e){},wG1d:function(t,e){},wWa2:function(t,e){}},["NHnr"]);